# 4장 엔티티매핑

매핑 애노테이션
- @Entity
   - Table과 매핑할 클래스를 선택
   - 속성
      - name: 엔티티 이름. 기본은 클래스 이름
   - 특징
      - 기본 생성자가 필수다. (파라미터가 없는 public 또는 protected 생성자)
- @Table 
   - 엔티티와 매핑할 테이블 지정. 생략하면 엔티티 이름을 테이블 이름으로 한다
   - 속성
      - name: 테이블 이름
      - catalog: catalog 기능이 있는 DB에서 catalog를 매핑
      - schema: schema 기능이 있는 DB에서 schema 매핑
- @Id
- @Column

DB 스키마 자동생성
- DDL:Data Definition Language
- 옵션
   - create: drop + create
   - create-drop: 애플리케이션이 종료할 때 생성한 ddl을 제거한다
   - update: DB table과 Entity 매핑정보를 비교해서 변경 사항만 수정한다
   - validate: DB table과 Entity 매핑정보를 비교해서 차이가 있으면 경고를 남기고 애플리케이션을 실행하지 않는다
   - none: 사용하지 않음
- 운영 서버에서는 절대로 create, create-drop, update 처럼 DLL을 수정하는 옵션을 사용하면 안된다
   - 개발 초기 단계는 create 또는 update
   - 초기화 상태로 자동화된 테스트를 진행하는 개발 환경과 CI 서버: create 또는 create-drop
   - 테스트 서버: update 또는 validate
   - 스테이징과 운영 서버: validate 또는 none
- 예시
   - column에 nullable과 length 설정
      ~~~java
      @Column(name = "NAME", nullable = false, length = 10)
      private String username;
      ~~~
   - table에 unique key 제약 조건 추가
      ~~~java
      @Entity
      @Table(name = "MEMBER", uniqueConstraints = {@UniqueConstraint(
            name = "NAME_AGE_UNIQUE",
            columnNames = {"NAME", "AGE"}
      )})
      public class Member {
      ~~~

기본키 관리
- @id만 선언: `primary key (id)` 설정이 추가된다
- @GeneratedValue 전략
   - IDENTITY
      - `id bigint generated by default as identity`가 추가
      - 엔티티가 영속상태가 되려면 식별자가 반드시 필요하기 때문에, 이 전략은 persist()를 하는즉시 DB에 insert query를 전달한다. 즉, 지연 쓰기가 동작하지 않는다
   - TABLE
      - 별도의 Table에서 Sequence 값을 관리
   - AUTO
      - 연결한 DB에 맞게 자동 선택
      - 예: 오라클: Squence, MySQL: IDENTITY 등
