## 언제 그리고 왜 도메인 이벤트를 사용할까
도메인 이벤트
- 도메인 이벤트는 도메인 모델을 완벽히 지원하며 도메인에서 일어난 어떤 사건을 나타낸다. 
- 어떤 일이 중요한지에 대해서는 도메인 전문가와 논의를 통해서 그들이 알려주는 단서에 귀 기울여야 한다.

도메인 이벤트 사용
- 이벤트가 로컬 시스템이든 외부 시스템이든 관심을 있는 대상으로 전달됐을 땐 보통 겨로가적 일관성을 위해 사용된다
![8-1](/Images/IDDD/8-1.jpg)
- 모델의 기술적 구현 측면이나 협업 시스템의 목표에 따라 도메인 전문가가 요구하는 수보다 이벤트가 더 많을 수 있다. 이런 상황에서 이벤트 소싱을 사용한다

## 이벤트의 모델링
모델링 규칙
- 해당 이벤트가 속한 바운디드 컨텍스트의 유비쿼터스 언어에 따라 이벤트와 그 속성을 명명하자
- 이름이 간단할수록 읽기 좋다. 그렇지만 당신의 팀이 좀 더 구체적인 이름을 선호한다면 그렇게 사용해도 좋다. 
   - BackLogItemCommitted와 BackLogItemCommittedToSprint
- 애그리게잇으로부터 이벤트를 발행할 땐 이벤트의 이름에 발생의 과거 시점을 반영하는 것이 중요하다
- 일어난 일의 의미를 나타내기 위해 필요한 다른 속성이 무엇인지 결정한다
- 구독자가 이베늩의 원인 이외의 상황까지 나타내주길 요청한다면, 추가적인 상태와 행동의 제공이 필요할 수 있다

애그리게잇의 특성과 함께하기
- 때론 클라이언트가 직접 요청한 내용을 바탕으로 이베늩가 생성되도록 설계하기도 한다.<br>
이는 모델 내 애그리게잇 인스턴스상에 위치한 행동을 실행한 직접적인 결과가 아닌 다른 일부 사건에 따른 응답으로써 이뤄진다.<br>
이런 방식으로 모델링하면, 이벤트는 애그리게잇처럼 모델 구조의 일부가 된다.<br>
즉 이런 이벤트는 과거에 일어난 일부 사건의 기록일 뿐만 아니라, 더 넓은 의미를 갖게 된다.

식별자
- 이벤트를 서로 구분해야할 때가 있지만 그런 상황은 굉장히 드물다. 하지만 비교를 해야 한다면 속성으로써 이벤트 식별자를 표현해주면 된다. 
- 이벤트의 이름/타입과 함께 이벤트를 유발시키는 데 관여한 애그리게잇의 식별자와 이벤트가 발생한 타임스탬프를 통해 구해낼 수 있다. 
- 속성만으로 구분할 수 없는 상황에선 이벤트가 정형적인 고유 식별자를 할당할 수 있다.
- 이벤트가 발생한 로컬 바운디드 컨텍스트의 밖에서 이벤트가 발행되면 메시징 인프라 스트럭처가 이를 전달하기 위해 고유 식별자가 필요해진다. 
- 일부 경우 메시지가 한 번 이상 전달될 수 있는데, 이 경우 원격구독자로 하여금 중복 메시지 전달을 감지하고 수신된 메시지를 무시하도록 하면 된다. 

## 도메인 모델에서 이벤트를 발행하기
도메인 이벤트를 도메인 모델 외부의 컴포넌트와 결합하지 않고 발행하는 가장 간단하고 효과적인 방법은 경량 옵저버의 생성이다. 
- 간단하다
- 이벤트가 발행할 때 네트워크를 통과하지 않기 때문인데, 등록된 모든 구독자는 발행자와 같은 프로세스 공간의 같은 스레드에서 실행된다. 

발행자
- 도메인 이벤트를 사용하는 가장 흔한 상황은 애그리게잇이 이벤트를 생성해서 발행할 때다. 
![8-2](/Images/IDDD/8-2.png)

구독자
- 구독자 등록
   - 애플리케이션 서비스에서 이뤄지며 때론 도메인 서비스에서 구독자 등록이 이루어 진다. 
   - 핵사고날 아키텍처를 사용할 땐 애플리케이션 서비스는 도메인 모델의 직접 적인 발행자가 애그리게잇에서 이벤트 생성 행동을 실행하기 전에 구독자를 등록할 수 있는 이상적인 위치다.
   - 도메인 서비스의 경우에는 이벤트를 리스닝해야 하는 특별한 이유가 있을 수 있다
- 구독자 대상
   - 이벤트를 발송하는 애그리게잇과 같은 스레드에서 실행 중인 모든 컴포넌트가 구독자가 될 수 있다
   - 이벤트의 발행에 앞서 구독이 이뤄진다
- 구독자는 다른 애그리게잇 인스턴스를 가져와서 변경을 유발하는 커맨드 행동을 수행해선 안 된다
- 이벤트 발행의 계약은 적어도 엔터프라이즈 범위나 그보다 더 넓은 범위에 속해야 한다.

## 뉴스를 원격 바운디드 컨텍스트로 전파하기
메시징 메커니즘
- 원격 바운디드 컨텍스트로 이벤트를 알리는 방법에는 여러가지가 있지만, 어떤 형태로든 메시징이 가능해야 하고, 엔터프라이즈 메시징 메커니즘이 필요하다. 
- 많은 메시징 컴포넌트가 있고 이는 '발행-구독' 범위에 속한다. 장단점이 있기 때문에 상황에 맞게 선택해야 한다. 
- 바운디드 컨텍스트 사이에서 사용하는 모든 메시지 메커니즘을 사용하기 위해선 결과적 일관성을 달성하려는 의지가 필요하다. 이는 포기할 수 없는 부분이다. 

메시징 인프라의 일관성


