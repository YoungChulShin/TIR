# CompletableFuture와 리액티브 프로그래밍 컨셉의 기초
병렬성과 동시성
- 병렬성
   - 2개 이상의 코어에서 각각의 작업이 실행되는것
- 동시성
   - 1개의 코어에서 각 작업이 번갈아가면서 실행되는것

스레드 추상화
- 운영체제는 각각의 작업을 위한 가상주소 공간을 각각의 프로세스에 제공한다
- 운영체제는 주기적으로 번갈아가면서 각 프로세스에 CPU를 할당한다
- 프로세스는 운영체제에 스레드를 요청함으로서 태스크(Runnable, Callable)을 동시에 또는 협력적으로 실행할 수 있다
- 병렬 스트림의 반복은 명시적으로 스레드를 사용하는 것이 비해 높은 수준의 개념이다
   - 예
      ```java
      sum = Arrays.stream(stats).parallel().sum();
      ```
   - 스트림을 이용해서 스레드 사용 패턴을 추상화할 수 있다

Executor와 스레드 풀
- 자바 5는 Executor 프레임워크와 스레드 풀을 통해서 태스크 제출과 실행을 분리할 수 있는 기능을 제공한다
   - Executor(ExecutorSerivce)는 runnable과 callable을 실행할 수 있다
   - 태스크 제출과 실행을 분리한다는 것은, 태스크 제출 이후에 다음 작업이 진행되는데 동시에 제출된 태스크의 실행은 다른 스레드를 통해서 진행한다
- 스레드의 문제
   - 자바 스레드는 운영체제에 직접 접근하는데, 운영체제 스레드를 만들고 종료하려면 비싼 비용을 치러야한다. 그리고 운영체제의 스레드는 수가 제한되어 있다. 
- 스레드 풀의 장점
   - ExecutorService는 워커스레드라 불리는 nThread를 포함하고, 이를 스레드풀에 저장한다
   - 스레드풀은 태스크를 순차적으로 실행하고 종료되면 반환한다.
   - 수천개의 태스크를 스레드풀에 오버헤드 없이 제출할 수 있다
- 스레드 풀의 단점
   - k 스레드를 가진 스레드풀은 k 만큼의 태스크를 동시에 실행할 수 있다. k 개 중에 n개가 블록이 된다면, 동시에 실행은 k-n개만 가능하다
   - 보통 자바 프로그램은 main이 반환되기 전에 모든 스레드의 작업이 종료되길 기다린다. Daemon을 설정해서 main이 종료될 때 종료되도록 할 수 있다
- 엄격한 포크조인과 여유로운 포크조인
   - 엄격한 포크조인: 반환하기 전에 포크조인으로 작업을 처리하는것. 주로 스트림
   - 여유로운 포크조인: 반환과 동시에 계속 실행을 하는 것

