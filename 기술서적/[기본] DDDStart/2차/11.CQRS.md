# CQRS
## 단일 모델의 단점
단일 모델의 경우 데이터를 저장하기는 좋지만, 여러 모델이 연관되는 클라이언트의 요청을 처리하기에는 Join이 발생하기 때문에 속도도 느리고, 구현을 복잡하게 만드는 원인이 된다. 
- 구현을 복잡하게 만드는 원인: 엔티티에 데이터 조회를 위한 로직이 들어가게 된다

## CQRS
시스템이 제공하는 기능은 크게 2가지로 나눌 수 있다. 
1. 상태를 변경하는 기능: 주로 1개 애그리거트를 변경한다
2. 상태를 조회하는 기능: 2개 이상의 애그리거트가 필요할 때가 많다

CQRS 특징
- Command Query Responabiltity Segregation
- 상태를 변경하는 명령(Command)과 상태를 제공하는 조회(Query) 모델을 분리하는 방법
- 복잡한 도메인에 적합하다. 도메인이 복잡할 수록 명령 기능과 조회 기능이 다루는 데이터의 범위가 차이가 난다.
- 각 모델에 맞는 구현 기술을 선택할 수 있다
   - 예: 명령 모델은 JPA를 사용하고, 조회 모델은 마이바티스를 사용
   - 예: 명령 모델은 RDBMS를 사용하고, 조회 모델은 NoSQL을 사용
      - 데이터 동기화는 이벤트를 이용한다
- 대규모 트래픽이 발생하는 웹 서비스는 명시적으로 명령 모델과 조회 모델을 구분하지 않았을 뿐이지, 조회 속도를 높이기 위해서 CQRS를 적용하는 것과 비슷한 내용을 사용하고 있다
   - 예: 조회 전용 모델을 캐시
   - 예: 조회 전용 저장소 사용

CQRS 장점
- 명령 모델을 구현할 때 도메인 자체에 집중할 수 있다
- 명령 모델에서 조회 관련 로직이 빠져서 복잡도가 사라진다
- 조회 성능을 향상시킬 수 있다
   - 조회 단위로 캐시를 적용
   - 조회에 특화된 쿼리를 사용
   - 조회 처리량을 대폭 올릴 수 있다. (조회 전용 노드를 수평 확장?)

CQRS 단점
- 구현할 코드가 더 많아진다. 따라서 트래픽이 작거나 복잡하지 않은 도메인은 적용했을 때 비용을 잘 따져봐야한다
- 더 많은 구현기술이 필요하다
- 모델이 변경되는 등의 운영 이슈에 대한 대응이 필요하다


