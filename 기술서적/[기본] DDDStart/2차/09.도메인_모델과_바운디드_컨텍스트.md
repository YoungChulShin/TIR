# 도메인 모델과 바운디드 컨텍스트
## 도메인 모델과 경계
처음 도메인 모델을 만들 때 빠지기 쉬운 함정은 도메인을 표현하는 단일 모델을 만드는 시도를 하는 것이다. 
- 도메인은 여러 하위 도메인으로 구성되는데, 모델이 각 하위 도메인마다 모두 동일한 의미를 가지지 않기 때문에 모델이 잘 못 만들어질 수 있다
- 예: 상품 모델
   - 카탈로그: 상품 정보 위주. 1개 존재
   - 재고관리: 실존하는 개별 객체를 추적하기 위한 목적. N개 존재
- 예: 회원 
   - 회원 도메인: 회원
   - 주문 도메인: 주문자
   - 배송 도메인: 보내는 사람

하위 도메인마다 사용하는 용어가 다르기 때문에 올바른 도메인 모델을 개발하려면 하위 도메인마다 모델을 만들어야한다.
- 모델은 컨텍스트 하에서 완벽한 의미를 갖는다. 같은 상품이라도 카탈로그 도메인과 재고 관리 도메인에서 의미가 다르다. 
- 구분되는 경계를 갖는 컨텍스트를 DDD에서는 바운디드 컨텍스트라고 부른다

## 바운디드 컨텍스트
바운디드 컨텍스트
- 모델의 경계를 결정한다
- 한 바운디드 컨텍스트는 논리적으로 한개의 모델을 갖는다
- 바운디드 컨텍스트는 용어를 기준으로 구분한다

하위 도메인과 바운디드 컨텍스트가 1:1 관계를 가지면 좋겠지만, 그렇지 않을 경우도 있다

작은 회사의 경우 전체 시스템을 한 개 팀에서 구현할 때가 있고, 이 경우 여러 하위 도메인이 한개의 바운디드 컨텍스트에 구현될 수 있다
- 이 경우 각 하위 도메인의 모델이 섞이지 않도록 패키지를 구분해서, 하위 바운디드 컨텍스트를 가지도록 한다

바운디드 컨텍스트는 모델을 구분하는 경계이기 때문에 바운디드 컨텍스트 구현은 하위 도메인에 알맞는 모델을 포함한다
- 같은 사용자라도 주문 바운디드 컨텍스트와 회원 바운디드 컨텍스트는 갖는 모델이 달라진다
   - 회원: Memeber, AggregateRoot
   - 주문: Orderer, Value

## 바운디드 컨텍스트 구현
바운디드 컨텍스트는 도메인 모델만 포함하는 것은 아니다. 도메인 기능을 사용자에게 제공하기 위한 표현 영역, 응용 서비스, 인프라스트럭쳐, 테이블을 모두 포함한다. 

각 바운디드 컨텍스트는 도메인에 맞게 구현 방식을 선택할 수 있다
- 예: 주문 바운디드 컨텍스트는 DDD 방식으로 하고, 복잡한 도메인 로직이 없는 리뷰 바운디드 컨텍스트는 서비스에 비지니스 로직을 구현하도록 할 수 있다
- 한 바운디드 컨텍스트에 2개의 방식을 혼합해서 쓸 수도 있다: CQRS

바운디드 컨텍스트에 따라 UI를 제공할 수도 있고, JSON 데이터를 보여줄 수도 있다. 성격에 따라서 앞단에 UI 서버를 둘 수도 있다. (BFF)

## 바운디드 컨텍스트 간 통합
상황
- 카탈로그 하위 도메인에 추가적인 추천 바운디드 컨텍스트가 추가되었다
- 2개의 팀이 각각의 바운디드 컨텍스트를 맡고 있고, 2개 사이에 통합이 발생할 수 있다

시나리오# 1: 사용자가 제품 상세 페이지를 볼 때, 보고 있는 상품과 유사한 상품 목록을 하단에 보여준다

구현 1. 카탈로그 바운디드 컨텍스트가 추천 바운디드 컨텍스트를 직접 호출하는 방법
- 카탈로그 바운디드 컨텍스트에는 추천 바운디드 컨텍스트를 호출하는 코드가 인프라스트럭처 레이어에 들어간다
- 2개의 바운디드 컨텍스트는 서로 모델이 다르기 때문에 카탈로그 바운디드 컨텍스트에는 추천 모델을 카탈로그 모델로 변환하는 변환코드가 들어간다

시나리오# 2: 추천시스템에서 사용자가 조회한 상품 이력이나 구매 내역을 필요로 할 경우
구현 1. 카탈로그 바운디드 컨텍스트와 추천 바운디드 컨텍스트 사이에 메시지 큐를 두는 방법. 모델은 카탈로그 기준으로 처리
- 추천 시스템에서 변환 코드를 구현하게 된다
- 발행/구독 모델 방식을 따른다

구현 2. 카탈로그 바운디드 컨텍스트와 추천 바운디드 컨텍스트 사이에 메시지 큐를 두는 방법. 모델은 추천 시스템 기준으로 처리
- 추천 시스템에서 변환 코드를 구현한다
- 추천 시스템이 제공하는 REST API를 이용해서 데이터를 전달하는 것과 차이가 없다

## 바운디드 컨텍스트 간 경계
바운디드 컨텍스트는 어떤 식으로든 연결되기 때문에 두 바운디드 컨텍스트는 다양한 방식으로 관계를 맺는다. 

관계1. 한쪽에서 API를 제공하고, 다른 쪽에서 호출하는 관계
- 고객/공급자 관계
- REST API가 대표적
- 예시
  ```
  카탈로그 바운디드 컨텍스트<downstream>  -------> 추천 바운디드 컨텍스<upstream>
  ```
   - downstream에서 upstream으로의 의존이 발생한다

관계2. 한 서비스를 호출하는 서비스가 여러개 있을 경우
- 오픈 호스트 서비스
- upstream 팀은 downstream 팀의 요구사항을 수용할 수 있는 API를 만들고 이를 공개해서 서비스의 일관성을 유지한다
- upstream 서비스는 자신의 바운디드 컨텍스트 모델을 가지기 때문에, downstream 컨텍스트에서 부패방지계층(anti corruuption layer)를 추가해준다
- 예시
  ```
  블로그 바운디드 컨텍스트<downstream>  -------> 검색 바운디드 컨텍스<upstream>
  카페 바운디드 컨텍스트<downstream>   -------> 
  게시판 바운디드 컨텍스트<downstream>  -------> 
  ```

관계3. 두 바운디드 컨텍스트가 같은 모델을 공유할 경우
- 공유 커널(shared kernel)
- 예: 주문관리도구를 개발하는 팀과 고객을 위한 주문 서비스를 개발하는 팀은 주문 모델을 공유할 수 있다
- 중복을 줄여주는 장점이 있지만, 하나의 모델을 2개 시스템에서 공유하기 때문에 임의로 모델을 변경할 수 없는 단점이 있다

관계4. 두 바운디드 컨텍스트간 통합을 하지 않는 방식. 서로 독집적으로 발전
- 독립(Separeate way) 방식
- 이 경우 통합은 수동으로 이루어진다. 예: 쇼핑몰에서 판매가 발생하면, ERP 시스템에 데이터를 입력해야 한다
- 규모가 커질 경우 통합 시스템을 고려한다

## 컨택스트 맵
개념
- 바운디드 컨텍스트 간에 관계를 표시한 맵
- 전체 바운디드 컨텍스트 간의 경계와 관계를 볼 수 있다