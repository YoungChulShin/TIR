# 가비지 수집 고급
## 트레이드오프와 탈착형 수집기
썬 마이크로시스템즈 환경 내부에서 GC는 탈착형 서비시스템으로 취급된다. 같은 자바 프로그램이라도 코드 변경 없이 여러가지 가비지 수집기에서 돌려볼 수 있다. 

개발자는 가비지 수집 선정 시 아래 항목을 고민해야한다
- 중단 시간
- 처리율
- 중단 빈도
- 회수 효율: GC 사이클당 얼마나 많은 가비지가 수집되는가?
- 중단 일관성: 중단 시간이 고른 편인가?

## G1 GC
특징
- 대용량 힙에서 중단 시간이 짧은 범용 수집기

### 레이아웃 및 영역
영역(region)으로 구성된다. 
- default 크기가 1MB인 메모리 공간. 2048~4095개의 영역이 있다. 
- 세대를 불연속 적으로 배치할 수 있고, 수집기가 매번 실행될 때마다 전체 가비지를 수집할 필요가 없다
- 에덴/서바이버/테뉴어드/거대 영역이 존재한다

### 알고리즘 설계
영 세대의 크기는 전체 중단 시간 목표에 따라서 조정된다.

RSet(remember set)
- 외부에서 힙 영역 내부를 참조하는 레퍼런스를 관리하기 위한 장치
- 영역마다 존재한다
- 영역의 내부를 참조하는 레퍼런스를 찾기 위해서 전체 힙을 다 뒤질필요 없이 RSet만 보면 된다
- Floating garbage라는 GC문제를 해결하는데 유용하다
   - 현재 수집 세트 외부에서 죽은 객체가 참조하는 바람에 이미 죽었어야할 객체가 살아있는 현상

### JVM Flag
G1 사용
```
+XX:UseG1GC
```

중단 시간 목표: 기본 200ms
```
-XX:MaxGCPauseMillis=200
```