# OAuth2 리소스 서버 구현
클라이언트는 권한 부여 서버에서 엑세스 토큰을 얻은 후 리소스 서바가 보호하는 사용자의 리소스에 접근한다. 
![14-1](/Images/스프링시큐티리인액션/14-1.jpg)

리소스 서버를 구현할 때 중요한 점은 서버가 토큰을 검증하는 방법을 선택하는 것이다. 
1. 리소스 서버가 직접 권한 부여 서버를 호출해서 토큰이 맞는지 확인하는 방법
   - 어던 종류의 토큰 구현에도 적용될 수 있는 장점이 있다. 
2. 권한부여 서버가 토큰을 저장할 때 공유된 데이터베이스를 사용하는 방법. 
   - 리소스 서버도 데이터베이스를 호출해서 토큰을 확인 및 검증할 수 있다.
3. 암호화 서명을 하는 방법.
   - 권한 부여 서버는 토큰을 발행할 때 토큰에 서명을 하고, 리소스 서버는 이를 검증한다. 

엔드포인트
- 기본적으로 권한 부여 서버는 리소스 서버가 토큰을 검증할 수 있는 `/oauth/check_token` 엔드포인트를 제공한다. 

## 리소스 서버가 직접 권한 부여 서버를 호출하는 방식
장점
- 구현하기 쉽다.
- 모든 토큰에 적용 가능하다. 

단점
- 권한 부여 서버에 부담이 생긴다. 
- 권한 부여 서버와 리소스 서버 간에 직접 종속성이 생긴다. 

## 공유 데이터베이스를 이용하는 방법
장점
- 권한 부여 서버를 호출할 필요가 없다. 
- 모든 토큰 구현에 적용 가능하다. 
- 권한 부여 서버가 재시작해도 권한 부여가 동작한다. 

단점
- 구현이 어렵다. 
- 공용 데이터베이스가 병목 지점이 될 수 있다. 

### TokenStore
TokenStore는 권한 부여 서버와 리소스 서버 양쪽에서 스프링 시큐리티로 토큰을 관리하는 객체를 나타내는 계약이다. 

인증이 완료되면 권한 부여 서버는 TokenStore를 이용해 토큰을 생성한다. 

![14-10](/Images/스프링시큐티리인액션/14-10.jpg)
![14-11](/Images/스프링시큐티리인액션/14-11.jpg)

