# CSRF 보호와 CORS 적용
## CSRF(사이트 간 요청 위조) 보호 적용
### 스프링 시큐리티의 CSRS 보호가 작동하는 방식
CSRF 공격 예시
1. 사용자가 웹 애플리케이션에 로그인한다. 
2. 음악을 듣기 위해서 특정 사이트를 접속한다. 
3. 음악 사이트에는 악의적인 문제가 있으며, 음악 외에 위조 스크립트를 전달 받는다. 
4. 스크립트는 로그인한 사용자 대신 특정 작업을 수행해서 원치않는 변경을 적용할 수 있다. 

CSRF 보호는 어떻게 작동할까?
- 사용자가 적어도 한번은 HTTP GET으로 웹 페이지를 요청한다는 것을 가정한다. 
- 이때 애플리케이션은 고유한 토큰을 생성한다. 
- 이후부터 애플리케이션은 변경 작업에 대해서 고유한 토큰을 검증한다. 

`CsrfFilter` 필터
- CSRF 보호 역할을 하는 필터.
- `CsrfTokenRepository` 를 이용해서 토큰을 생성/저장/검증에 필요한 값을 관리한다. 
   - 기본 구성은 토큰을 HTTP 세션에 저장하고, UUID로 토큰을 생성한다.

CSRF보호는 브라우저에서 실행되는 웹 앱에 이용되며, 앱의 표시된 콘텐츠를 로드하는 브라우저가 변경 작업을 수행할 수 있다고 예상될 때 필요하다.
- 모바일 클라이언트가 있거나 프론트엔드를 별도의 프레임워크로 개발했을 경우에는 작동하지 않는다. 
- 기본적으로 GET, HEAD, TRACE, OPTIONS 외의 HTTP 방식으로 호출되는 엔드포인트에 적용된다. 

__CSRF 보호 샘플 코드__
- https://github.com/YoungChulShin/book-spring-security-in-action/tree/master/ch10-ex1-csrf

애플리케이션이 맞춤으로 CSRF 토큰을 관리하는 방식을 변경해야할 경우 아래 내용을 확인한다. 
- 스프링 시큐리티의 연관 클래스
   - CsrfToken: 토큰 정보를 기술한다.
      - 헤더 이름: X-CSRF-TOKEN
      - 토큰의 값을 저장하는 요청의 특성 이름: _csrf
   - CsrfTokenRepository: CSRF 토큰을 생성, 저장, 로드하는 객체를 기술한다.

